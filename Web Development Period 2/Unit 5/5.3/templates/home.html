<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {font-family: Arial, Helvetica, sans-serif;}

/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

/* The Close Button */
.close {
  color: gray;
  float: right;
  font-size: 28px;
  font-weight: bold; 
}

.close:hover,
.close:focus {
  color:black;
  text-decoration: none;
  cursor: pointer;    
}
</style>
</head>
<body>

<h2>Assingment 5.3</h2>

{% if logged_in %}
  <p>Please tell me this is your username:{{ username }}, if not you can do anything with this account.</p>
  <p><a href="/premiumcontent">Logged in continue here</a></p>
  <a href="/logout">Logout</a>
{% else %}
  <p>You are not logged in.</p> 
  <button id="myBtn">Login</button>
{% endif %}

<hr>


<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <form action="/login" method="POST">
      <label>Username:</label><br>
      <input type= "text" name="username"><br><br>

      <label>Password:</label><br>
      <input type ="password" name="password"><br><br>

      <input type= "submit" value="Log In">
    </form>
  </div>
</div>

<!-- INVALID LOGIN MODAL -->
<div id="badLoginModal" class="modal">
  <div class="modal-content">
    <p>Username or password was incorrect.</p>
    <button onclick="document.getElementById('badLoginModal').style.display='none'">OK</button>
  </div>
</div>

<!-- AUTH ERROR MODAL -->
<div id="authErrorModal" class="modal">
  <div class="modal-content">
    <h3>YOU NEED TO AUTHENTICATED YOURSELF</h3>
    <p>You forgot to login most likely, so you can't do anything</p>
    <button onclick="document.getElementById('authErrorModal').style.display='none'">OK</button>
  </div>
</div>

<!-- LOGOUT SUCCESS MODAL -->
<div id="loggedOutModal" class="modal">
  <div class="modal-content">
    <h3>Logged Out</h3>
    <p>You have been successfully logged out.</p>
    <button onclick="document.getElementById('loggedOutModal').style.display='none'">OK</button>
  </div>
</div>

<script>
// Get the main login modal (from W3 example)
var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the login modal 
if (btn) {
  btn.onclick = function() {
    modal.style.display = "block";
  }
}

// When the user clicks on <span> (x), close the login modal
if (span) {
  span.onclick = function() {
    modal.style.display = "none";
  }
}

// Other modals
var badLoginModal = document.getElementById("badLoginModal");
var authErrorModal = document.getElementById("authErrorModal");
var loggedOutModal = document.getElementById("loggedOutModal");

// When the user clicks anywhere outside of a modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
  if (event.target == badLoginModal) {
    badLoginModal.style.display = "none";
  }
  if (event.target == authErrorModal) {
    authErrorModal.style.display = "none";
  }
  if (event.target == loggedOutModal) {
    loggedOutModal.style.display = "none";
  }
}

// Show feedback modals based on URL parameters
var params = new URLSearchParams(window.location.search);

if (params.get("success") === "false") {
  badLoginModal.style.display = "block";
}

if (params.get("auth_error") === "true") {
  authErrorModal.style.display = "block";
}

if (params.get("logout") === "true") {
  loggedOutModal.style.display = "block";
}
</script>

</body>
</html>
